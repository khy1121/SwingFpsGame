# 맵 편집 & 단축키 가이드

게임 클라이언트(`GamePanel`)에 내장된 인게임 맵 편집 모드와 관련 JSON 포맷, 단축키 사용법을 정리한 문서입니다. 새로운 맵(예: `airport`)을 빠르게 제작·수정하고 테스트할 수 있습니다.

## 1. 맵 파일 구조 개요
맵은 PNG 배경 이미지 + JSON 데이터 조합으로 동작합니다.
- 배경 이미지: `assets/maps/<mapName>.png` (미니맵에도 축소 표시)
- 기본 데이터: `assets/maps/<mapName>.json`
- 수정본 우선 로드:
  1. `assets/maps/<mapName>_edited.json`
  2. `assets/maps/<mapName>.edited.json`
  3. `assets/maps/<mapName>.json`

> 즉, 인게임에서 저장(Ctrl+S / F5)하면 `<mapName>_edited.json`이 생성·갱신되고 다음 실행 시 자동으로 가장 먼저 로드됩니다.

## 2. JSON 포맷 상세
예시: `airport_edited.json`
```jsonc
{
  "meta": {
    "map_pixel_size": { "w": 1184, "h": 864 }, // 전체 실제 픽셀 크기
    "tile_size": 32                                 // 한 타일의 픽셀 크기
  },
  "obstacles": [                                    // 이동 불가(벽) 타일들의 (x,y)
    { "x": 0, "y": 0 },
    { "x": 1, "y": 0 }
    // ...
  ],
  "spawns": {
    "red": { "tiles": [ { "x": 0, "y": 0 }, { "x": 1, "y": 0 } /* ... */ ] },
    "blue": { "tiles": [ { "x": 66, "y": 41 }, { "x": 67, "y": 41 } /* ... */ ] }
  }
}
```
### 필드 설명
- `meta.map_pixel_size`: 배경 이미지 실제 크기(편집 및 미니맵 스케일 계산 시 사용)
- `meta.tile_size`: 격자 한 칸의 픽셀 폭/높이 (현재 32 고정 권장)
- `obstacles`: 플레이어/미사일/대쉬가 통과할 수 없는 타일 좌표 배열
- `spawns.red.tiles`, `spawns.blue.tiles`: 팀별 스폰 가능한 타일 집합(랜덤 혹은 순차 선택 가능)

### 좌표 체계
- 타일 좌표 (col=x, row=y)
- 실제 픽셀 위치 = `(x * tile_size, y * tile_size)`

## 3. 인게임 편집 모드 (Edit Mode)
맵을 실행 중 바로 편집할 수 있습니다.
### 진입/종료
- `F4`: 편집 모드 토글 (ON/OFF)

### 편집 시 화면 요소
- 타일 그리드 오버레이: 이동 가능 타일은 반투명 녹색, 불가(벽) 타일은 반투명 빨강
- 마우스 호버 타일 하이라이트: 노란 테두리 또는 강조 색 (구현 버전에 따라 다를 수 있음)

### 편집 모드 도구 (3종)
- 이동 가능 칠하기: 통로(녹색)로 지정
- 이동 불가 칠하기: 벽(빨강)으로 지정
- 스폰 타일 지정: 팀별 스폰 타일(RED/BLUE)을 클릭으로 토글

### 단축키로 도구 전환
- 1: 이동 가능 칠하기
- 2: 이동 불가(벽) 칠하기
- 3: RED 스폰 타일 토글
- 4: BLUE 스폰 타일 토글

### 마우스 조작
- 왼쪽 버튼 클릭 & 드래그: 현재 선택된 도구로 계속 칠해짐/토글됨
- 스폰으로 지정된 타일은 항상 이동 가능으로 강제되며, 상대 팀 스폰과 중복 지정 시 서로 겹치지 않도록 자동 정리됨
- 드래그 중 실시간 반영: 저장 전이라도 내부 `walkableGrid`와 `obstacles` 재계산 기준으로 충돌/이동 검출에 즉시 영향

### 저장
- `Ctrl+S` 또는 `F5`: 현재 편집 결과를 JSON으로 저장 → `<mapName>_edited.json` 생성/덮어쓰기
  - 저장 즉시 파일 내용이 디스크에 기록되며 다음 클라이언트 실행 시 우선 로드됨
  - 저장 내용에는 벽(`obstacles`)과 팀별 스폰 타일(`spawns.red.tiles`, `spawns.blue.tiles`)이 포함됨

## 4. 맵 전환 & 테스트 흐름
### 맵 스위치
- `F6`: 기본 `map` ↔ `airport` 두 맵 사이를 즉시 전환 (코드 내부 `switchMap()` 사용)
  - 전환 시: 카메라/플레이어 위치 재설정, 미사일 초기화, 서버에 위치 전송

### 빠른 제작 사이클
1. `assets/maps/airport.png` 준비 (선택 사항이지만 권장)
2. 임시 `airport.json` 작성 또는 아무것도 없이 실행 → 기본 맵 로드 실패 시 fallback 로직 확인
3. 게임 실행 후 `F6`로 `airport` 전환
4. `F4` 편집 모드 진입, 벽/통로 타일 드래그로 구성
5. 스폰 타일은 수동으로 JSON에 편집하거나 초기 맵에서 지정 (인게임 에디터가 스폰 선택 UI 제공하지 않는 경우 수동 편집 필요)
6. `Ctrl+S` 저장 → `airport_edited.json` 생성
7. 재실행하거나 계속 플레이하며 충돌/동선 테스트

## 5. 단축키(핫키) 요약
| 키 | 기능 |
| --- | --- |
| F4 | 맵 편집 모드 토글 |
| 1 | 이동 가능 칠하기 도구 |
| 2 | 이동 불가(벽) 칠하기 도구 |
| 3 | RED 스폰 타일 토글 도구 |
| 4 | BLUE 스폰 타일 토글 도구 |
| Ctrl+S | 현재 편집 결과 저장 (`<mapName>_edited.json`) |
| F5 | 저장(에디터 편의용, Ctrl+S와 동일) |
| F6 | 맵 전환 (`map` ↔ `airport`) |
| 좌클릭 / 드래그 | 편집 모드: 선택된 도구로 페인트/토글 · 일반 모드: 공격(기본 공격) |

> 프로젝트에 존재하지만 본 문서에 미기재된 키는 추후 확장하면서 추가하세요.

## 6. 권장 제작 규칙 & 팁
- 타일 크기 통일: `tile_size`는 모든 맵에서 동일(32)로 유지 → 충돌/스킬/대쉬 계산 단순화
- 경계(바깥 테두리) 먼저 막기: 플레이어가 맵 밖으로 나가는 예외 방지
- 스폰 영역 충분히 넓게: 팀 간 겹침 최소화, 초기 충돌 방지
- 저장 전 빠른 동선 체크: 에디터에서 드래그 후 바로 플레이 움직임으로 막힘/길 확인
- 맵 이름은 소문자·언더스코어 권장: 로딩 우선순위 파일명 규칙 간결화

## 7. 문제 해결 (Troubleshooting)
| 증상 | 가능한 원인 | 해결 |
| --- | --- | --- |
| 맵이 로드되지 않고 기본 맵만 반복 | `<mapName>_edited.json` 혹은 `.json` 손상/구문 오류 | JSON 포맷 검사(마지막 쉼표 제거, 괄호 짝) 후 재저장 |
| 미니맵에 배경이 안 뜸 | 해당 PNG 없거나 경로 불일치 | `assets/maps/<mapName>.png` 파일명 확인 |
| 대쉬가 벽을 통과 | 해당 타일을 통로로 칠했거나 벽 누락 | 편집 모드에서 해당 부분을 "벽"으로 다시 칠하고 저장 |
| 스폰 위치 이상(겹침) | `spawns.red/blue.tiles`가 좁거나 중첩 | 넓은 영역 지정, 서로 떨어진 구역 확보 |

## 8. 향후 확장 아이디어
- 브러시 크기(1x1, 2x2, 3x3) 선택 UI
- Undo/Redo 스택
- 스폰 타일 인게임 시각 편집
- 영역 선택 후 일괄 토글 기능
- 맵 이름 동적 입력 & 즉시 새 맵 생성 기능

## 9. 빠른 체크리스트
- [ ] PNG 배경 준비
- [ ] 기본 JSON(또는 빈 상태에서 인게임 제작) 로드 확인
- [ ] F4 편집 가능 여부
- [ ] 벽/통로 색상 정상 표시
- [ ] 저장(Ctrl+S/F5) 후 파일 생성 확인
- [ ] 재실행 시 `_edited` 버전 자동 로드
- [ ] F6 맵 전환 정상 동작
- [ ] 스폰 타일 적절히 배치

## 10. 예시 워크플로 (Airport)
1. `assets/maps/airport.png` 복사
2. 클라이언트 실행 → 기본 맵 확인
3. F6 → `airport` 전환
4. F4 → 편집 모드, 벽 드래그 작성
5. Ctrl+S → 저장(`airport_edited.json` 생성)
6. 이동/대쉬 테스트, 필요시 재편집 반복

---
문서 업데이트 시: README에 링크 추가 후 변경 사항(버전/날짜) 기록을 권장합니다.
